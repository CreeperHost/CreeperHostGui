buildscript {
    repositories {
        jcenter()
        mavenCentral()
        maven { url = "http://files.minecraftforge.net/maven" }
    }
    dependencies {
        classpath 'net.minecraftforge.gradle:ForgeGradle:2.3-SNAPSHOT'
        classpath "com.github.jengelman.gradle.plugins:shadow:2.0.0"
    }
}
apply plugin: 'net.minecraftforge.gradle.forge'
apply plugin: "com.github.johnrengelman.shadow"

sourceCompatibility = 1.8
targetCompatibility = 1.8

version = "1.12.2-2.3.0beta2"

minecraft {
    version = "1.12.2-14.23.5.2768"
    runDir = "run"

    mappings = "snapshot_20161220"
    makeObfSourceJar = false

    replaceIn "CreeperHost.java"
    replace "@VERSION@", project.version.toString()
}

dependencies {
    compileOnly group: 'com.google.code.gson', name: 'gson', version: '2.2.4'
    compileOnly group: 'commons-io', name: 'commons-io', version: '2.4'
    compileOnly group: 'org.apache.logging.log4j', name: 'log4j-api', version: '2.8.1'
    compile 'org.kitteh.irc:client-lib:7.2.2'
    compile group: 'org.nanohttpd', name: 'nanohttpd', version: '2.3.1'
    compile 'com.github.scribejava:scribejava-apis:6.9.0'
}

shadowJar {
    // Only shadow fluent-hc
    dependencies {
        include(dependency('org.kitteh.irc:client-lib:7.1.0'))
        include(dependency('com.github.scribejava:scribejava-apis:6.9.0'))
        include(dependency('com.github.scribejava:scribejava-core:6.9.0'))
        include(dependency('org.nanohttpd:nanohttpd:2.3.1'))
    }

    // Relocate fluent-hc to prevent conflicts with other mods that include it
    relocate 'org.kitteh.irc', 'net.creeperhost.minetogether.org.kitteh.irc'
    relocate 'com.github.scribejava', 'net.creeperhost.minetogether.com.github.scribejava'
    relocate 'fi.iki.elonen', 'net.creeperhost.minetogether.fi.iki.elonen'

    classifier '' // Replace the default JAR
}

processResources
        {
            // this will ensure that this task is redone when the versions change.
            inputs.property "version", project.version
            inputs.property "mcversion", project.minecraft.version

            // replace stuff in mcmod.info, nothing else
            from(sourceSets.main.resources.srcDirs) {
                include 'mcmod.info'

                // replace version and mcversion
                expand 'version':project.version, 'mcversion':project.minecraft.version
            }

            // copy everything else, thats not the mcmod.info
            from(sourceSets.main.resources.srcDirs) {
                exclude 'mcmod.info'
            }
        }

task deobfJar(type: Jar) {
    from sourceSets.main.output
    classifier = 'dev'
}

build.dependsOn deobfJar

reobf {
    shadowJar {} // Reobfuscate the shadowed JAR
}